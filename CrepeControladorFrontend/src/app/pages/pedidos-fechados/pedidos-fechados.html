<div class="pedidos-fechados-container container py-4">
  <div class="pedidos-loading-overlay" *ngIf="carregando">
    <div class="pedidos-spinner"></div>
    <p>Carregando pedidos...</p>
  </div>

  <div class="tabs">
    <button class="tab active" type="button">Resumo</button>
  </div>

  <div class="aba-tipos">
    <div class="abas-internas">
      <button
        type="button"
        [class.active]="abaAtiva === 'finalizado'"
        (click)="selecionarAba('finalizado')"
      >
        Finalizado ({{ pedidosFinalizados.length }})
      </button>
      <button
        type="button"
        [class.active]="abaAtiva === 'cancelado'"
        (click)="selecionarAba('cancelado')"
      >
        Cancelado ({{ pedidosCancelados.length }})
      </button>
    </div>

    <div class="lista-processos" *ngIf="pedidosAtuais.length">
      <div *ngFor="let pedido of pedidosVisiveis" class="linha-processo">
        <span class="codigo">{{ pedido.codigo }}</span>
        <span class="status">
          <i class="fa-solid fa-circle" [style.color]="corStatus(pedido.status)"></i>
          {{ pedido.status }}
        </span>
        <span><i class="fa-solid fa-user"></i> {{ clienteOuPadrao(pedido) }}</span>
        <span><i class="fa-solid fa-coins"></i> {{ pedido.valorTotal | currency:'BRL':'symbol':'1.2-2' }}</span>
        <button class="btn-acao" type="button" (click)="abrirDetalhes(pedido)">Ver recibo</button>
      </div>
    </div>

    <div class="estado-vazio" *ngIf="!pedidosAtuais.length">
      Nenhum pedido {{ abaAtiva === 'finalizado' ? 'finalizado' : 'cancelado' }}.
    </div>

    <div class="paginacao-preparando" *ngIf="totalPaginas > 1">
      <button
        type="button"
        class="paginacao-nav"
        (click)="alterarPagina(-1)"
        [disabled]="paginaAtual === 1"
      >
        <span aria-hidden="true">&larr;</span>
        <span class="sr-only">Pagina anterior</span>
      </button>
      <div class="paginacao-dots">
        <button
          type="button"
          class="paginacao-dot"
          *ngFor="let pagina of paginasCarousel"
          [class.active]="pagina === paginaAtual"
          (click)="irParaPagina(pagina)"
          [attr.aria-label]="'Ir para pagina ' + pagina"
        ></button>
      </div>
      <button
        type="button"
        class="paginacao-nav"
        (click)="alterarPagina(1)"
        [disabled]="paginaAtual === totalPaginas"
      >
        <span aria-hidden="true">&rarr;</span>
        <span class="sr-only">Proxima pagina</span>
      </button>
    </div>
  </div>

  <div class="modal-overlay-detalhe" *ngIf="modalDetalhesAberto" (click)="fecharModalDetalhes()">
    <div class="modal-detalhes" (click)="$event.stopPropagation()">
      <button class="btn-fechar" (click)="fecharModalDetalhes()">
        <i class="fa-solid fa-times"></i>
      </button>

      <div *ngIf="carregandoDetalhes" class="modal-loading">
        <div class="pedidos-spinner"></div>
        <p>Carregando pedido...</p>
      </div>

      <ng-container *ngIf="!carregandoDetalhes && pedidoSelecionado as pedido">
        <h2>{{ pedido.codigo }}</h2>
        <div class="status-row">
          <span class="status">
            <i class="fa-solid fa-circle" [style.color]="corStatus(pedido.status)"></i>
            {{ pedido.status }}
          </span>
          <span class="tipo">{{ pedido.tipoPedido }}</span>
        </div>

        <p><i class="fa-solid fa-user"></i> {{ clienteOuPadrao(pedido) }}</p>
        <p><i class="fa-solid fa-calendar-days"></i> Criado em {{ formatarData(pedido.dataCriacao) }}</p>
        <p><i class="fa-solid fa-calendar-check"></i> Encerrado {{ formatarData(pedido.dataConclusao) }}</p>
        <p><i class="fa-solid fa-comment"></i> {{ pedido.observacao || 'Sem observacoes.' }}</p>
        <p class="valor-total">
          <i class="fa-solid fa-coins"></i>
          Total: {{ pedido.valorTotal | currency:'BRL':'symbol':'1.2-2' }}
        </p>

        <div class="lista-itens">
          <h3>Itens do pedido</h3>
          <div class="item" *ngFor="let item of pedido.itens">
            <div>
              <strong>{{ item.nomeItem }}</strong>
              <p>{{ item.quantidade }} x {{ item.precoUnitario | currency:'BRL':'symbol':'1.2-2' }}</p>
            </div>
            <span>{{ item.totalItem | currency:'BRL':'symbol':'1.2-2' }}</span>
          </div>

          <div class="estado-vazio" *ngIf="pedido.itens.length === 0">
            Nenhum item cadastrado para este pedido.
          </div>
        </div>
      </ng-container>
    </div>
  </div>
</div>
